<!DOCTYPE html>
<html>

<head>
      <!--External Library that allows the "posting" of messages from the page in the iFrame to "listeners" in Bullhorn -->
    <script src="https://cdn.rawgit.com/krakenjs/post-robot/7da06445/dist/post-robot.js"></script>
</head>

<body>

	<h1>Hello <span id="un"></span></h1>
	<script>
		//postRobot is the JS object instantiated to make calls to the BH app hosting the iFrame
    postRobot.CONFIG.LOG_LEVEL = 'info';

    //Register the "Post Robot" so we can make calls to BH
    postRobot.sendToParent('register', {
        title: 'Hello',
        url: window.location.href,
        color: 'green'
    }).then(function (event) {
        console.log('[REMOTE] Register Complete', event);
        getUserDetails();
	callBack();
    });

function getUserDetails(){
	console.log('[REMOTE] Getting user details');
    //Call the "requestDat" listener in BH via postRobot (in BH this is called AppBridge)
    postRobot.sendToParent('requestData', {
            type: 'all'
        }).then(function (userdata) {
            //Put what you want to do with the data here...
            console.log('[REMOTE] Get User Complete', userdata);
            document.getElementById('un').innerText = userdata.data.data.username;
        });
}
function callBack(){
	console.log('[REMOTE] Attempting callback');
	const message = { key: GenericCallbackKeys.FILE, generic: true };
    //Call the "requestDat" listener in BH via postRobot (in BH this is called AppBridge)
    postRobot.sendToParent('callback', {
            callingChannelID: 'ActionsWnd',
	    key:"CUSTOM_MESSAGE",
	    generic: true,
	    options: {}
        }).then(function (response) {
            //Put what you want to do with the data here...
            console.log('[REMOTE] response from callback',response);
        });
}		
		
		
	</script>
</body>

</html>
